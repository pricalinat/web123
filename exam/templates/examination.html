{% load staticfiles %}
<!DOCTYPE html>
<html>
<head>

     <title>Exam</title>
     <meta charset="UTF-8">
     <meta http-equiv="X-UA-Compatible" content="IE=Edge">
     <meta name="description" content="">
     <meta name="keywords" content="">
     <meta name="author" content="">
     <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

     <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
     <link rel="stylesheet" href="{% static 'css/magnific-popup.css' %}">
     <link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}">

     <!-- MAIN CSS -->
     <link rel="stylesheet" href="{% static 'css/templatemo-style.css' %}">
     <link rel="stylesheet" href="{% static 'css/challenges.css' %}">
    <script src="{%static 'js/jquery.js' %}"></script>

     <script src="{%static 'js/jquery.stellar.min.js' %}"></script>
     <script src="{%static 'js/jquery.magnific-popup.min.js' %}"></script>
</head>
<body>

     <!-- PRE LOADER -->
     <section class="preloader">
          <div class="spinner">
               <span class="spinner-rotate"></span>
          </div>
     </section>


     <!-- MENU -->
     <section class="navbar custom-navbar navbar-fixed-top" role="navigation">
          <div class="container">

               <div class="navbar-header">
                    <button class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                         <span class="icon icon-bar"></span>
                         <span class="icon icon-bar"></span>
                         <span class="icon icon-bar"></span>
                    </button>

                    <!-- lOGO TEXT HERE -->
                    <a href="/accounts/" class="navbar-brand">MyCTF</a>
               </div>

               <!-- MENU LINKS -->
               <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-nav-first">
                         <li><a href="#home" class="smoothScroll">Home</a></li>
                         <li><a href="#low" class="smoothScroll">Low</a></li>
                         <li><a href="#medium" class="smoothScroll">Medium</a></li>
                         <li><a href="#high" class="smoothScroll">high</a></li>
                         <li><a href="/challenges/collection/" class="smoothScroll">Collection</a></li>
                         <li><a href="/challenges/" class="smoothScroll">Switch</a></li>
                    </ul>
                    <button><a href="/exam/end_exam/">交卷</a></button>
                    <ul class="nav navbar-nav navbar-right">
                         <li class="section-btn"><a href="/accounts/logout/">Logout</a></li>
                    </ul>
               </div>

          </div>
     </section>


     <!-- BLOG HEADER -->
     <section id="blog-header" data-stellar-background-ratio="0.5">
          <div class="overlay"></div>
          <div class="container">
               <div class="row">

                    <div class="col-md-offset-1 col-md-5 col-sm-12">
                         <h2>Welcome to MyCTF!</h2>
                    </div>

               </div>
          </div>
     </section>


     <!-- BLOG DETAIL -->
     <section data-stellar-background-ratio="0.5">
          <div class="container">
               <div class="row"><br>
                    <div class="col-md-12 col-sm-12">
                         <div class="section-title">
                              <h2 id="endtime">{{time}}</h2>
                              <span class="line-bar">...</span>
                         </div>
                    </div>
                    {% if problems %}
                        {% for mission in problems %}
                            <div class="col-md-4 col-sm-6">
                            {% if mission.is_solved == 1  %}
                                <div class="solved_mission"  data-toggle="modal" data-target="#{{ mission.id }}" id="display_{{ mission.id }}">
                                <p style="color:white;">{{ mission.name }}</p>
                                {% if mission.category == 0 %}
                                    <span style="color:white;font-size: 14px;">（reverse）</span>
                                {% elif mission.category == 1 %}
                                    <span style="color:white;font-size: 14px;">（pwn）</span>
                                {% elif mission.category == 2 %}
                                    <span style="color:white;font-size: 14px;">（web）</span>
                                {% elif mission.category == 3 %}
                                        <span style="color:white;font-size: 14px;">（crypto）</span>
                                {% endif %}
                                <p style="color:white;">{{ mission.point }}</p>
                                </div>
                            {% else %}
                                <div class="mission"  data-toggle="modal" data-target="#{{ mission.id }}" id="display_{{ mission.id }}">
                                    <p style="color:white;">{{ mission.name }}</p>
                                    {% if mission.category == 0 %}
                                    <span style="color:white;font-size: 14px;">（reverse）</span>
                                    {% elif mission.category == 1 %}
                                        <span style="color:white;font-size: 14px;">（pwn）</span>
                                    {% elif mission.category == 2 %}
                                        <span style="color:white;font-size: 14px;">（web）</span>
                                    {% elif mission.category == 3 %}
                                        <span style="color:white;font-size: 14px;">（crypto）</span>
                                    {% endif %}
                                    <p style="color:white;">{{ mission.point }}</p>
                                </div>
                            {% endif %}
                            </div>
                            <div class="modal fade" id="{{ mission.id }}" role="dialog" data-backdrop="static">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close closeIT" data-dismiss="modal">&times;</button>
                                            <h4 class="modal-title">{{ mission.name }}</h4>
                                        </div>
                                        <div class="modal-body">
                                            <p><b>Challenge Description: </b></p>
                                            {% if mission.message %}
                                                <p>{{ mission.message }}</p>
                                            {% else %}
                                                暂无
                                            {% endif %}
                                            {% if mission.scene %}
                                                <p>{{ mission.scene }}</p>
                                            {% endif %}
                                            {% if mission.file %}
                                                <p><b>File:</b> <a href="uploads/{{ mission.file }}">download</a></p>
                                            {% endif %}
                                            <p><b>Points: </b>{{ mission.point }}</p>
                                            <form method="post" id="{{ mission.id }}_flag_form" action="/challenges/{{ mission.id }}/">
                                                {% csrf_token %}
                                                <input type="text" name="{{ mission.id }}_flag" class="input_flag" placeholder="Submit Flag" id="{{ mission.id }}_flag" autofocus>
                                                <br><br><button type="submit" name="submit" class="input_flag_button">Submit</button>
                                                <br>
                                                <br>
                                            </form>
                                            {% if mission.is_collected %}
                                                <a id="{{ mission.id }}_collect" href="/challenges/collect/{{ mission.id }}/">取消收藏</a>
                                            {% else %}
                                                <a id="{{ mission.id }}_collect" href="/challenges/collect/{{ mission.id }}/">收藏</a>
                                            {% endif %}
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <script type="text/javascript">
                                $(document).ready(function (){
                                    $("#{{ mission.id }}_flag_form").submit(function(event) {
                                        $.ajax({
                                            type : "POST",
                                            url : "/challenges/{{ mission.id }}/",
                                            data : $(this).serialize(),
                                            success : function(response) {
                                                $("#{{ mission.id }}_flag_form").append(response)
                                            }
                                        });
                                        event.preventDefault();
                                    });
                                });

                            </script>

                        {% endfor %}

                    {% else %}
                        <p style="color: red">None</p>
                    {% endif %}



               </div>
          </div>
     </section>



     <!-- FOOTER -->
     <footer data-stellar-background-ratio="0.5">
          <div class="container">
               <div class="row">

                    <div class="col-md-5 col-sm-12">
                         <div class="footer-thumb footer-info">
                              <h2>MyCTF</h2>
                              <p>CTF (Capture The Flag) is originated in the 1996 DEFCON Global Hacking Conference, a competitive game among cybersecurity enthusiasts.</p>
                         </div>
                    </div>

                    <div class="col-md-2 col-sm-4">
                         <div class="footer-thumb">
                              <h2>Rank</h2>
                              <ul class="footer-link">
                                   <li><a href="/scoreboard/">Personal</a></li>
                                   <li><a href="/scoreboard/">Team</a></li>
                                   <li><a href="/scoreboard">Challenge</a></li>
                              </ul>
                         </div>
                    </div>

                    <div class="col-md-2 col-sm-4">
                         <div class="footer-thumb">
                              <h2>Challenge</h2>
                              <ul class="footer-link">
                                   <li><a href="/challenges/">Pwn</a></li>
                                   <li><a href="/challenges/">Web</a></li>
                                   <li><a href="/challenges/">Re</a></li>
                              </ul>
                         </div>
                    </div>

                    <div class="col-md-3 col-sm-4">
                         <div class="footer-link">
                              <h2>Team</h2>
                              <li><a href="/teams/">Create</a></li>
                              <li><a href="/teams/">Join</a></li>
                         </div>
                    </div>
                    <div class="col-md-12 col-sm-12">
                         <div class="footer-bottom">
                              <div class="col-md-6 col-sm-5">
                                   <div class="copyright-text">
                                        <p>Copyright &copy; 2019 MyCTF</p>
                                   </div>
                              </div>
                              <div class="col-md-6 col-sm-7">
                                   <div class="phone-contact">
                                        <p>Call us <span>15632721215</span></p>
                                   </div>
                              </div>
                         </div>
                    </div>

               </div>
          </div>
     </footer>


     <!-- MODAL -->
     <section class="modal fade" id="modal-form" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg">
               <div class="modal-content modal-popup">

                    <div class="modal-header">
                         <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                         </button>
                    </div>

                    <div class="modal-body">
                         <div class="container-fluid">
                              <div class="row">

                                   <div class="col-md-12 col-sm-12">
                                        <div class="modal-title">
                                             <h2>MyCTF</h2>
                                        </div>

                                        <!-- NAV TABS -->
                                        <ul class="nav nav-tabs" role="tablist">
                                             <li class="active"><a href="#sign_up" aria-controls="sign_up" role="tab" data-toggle="tab">Create an account</a></li>
                                             <li><a href="#sign_in" aria-controls="sign_in" role="tab" data-toggle="tab">Sign In</a></li>
                                        </ul>

                                        <!-- TAB PANES -->
                                        <div class="tab-content">
                                             <div role="tabpanel" class="tab-pane fade in active" id="sign_up">
                                                  <form action="#" method="post">
                                                       <input type="text" class="form-control" name="name" placeholder="Name" required>
                                                       <input type="telephone" class="form-control" name="telephone" placeholder="Telephone" required>
                                                       <input type="email" class="form-control" name="email" placeholder="Email" required>
                                                       <input type="password" class="form-control" name="password" placeholder="Password" required>
                                                       <input type="submit" class="form-control" name="submit" value="Submit Button">
                                                  </form>
                                             </div>

                                             <div role="tabpanel" class="tab-pane fade in" id="sign_in">
                                                  <form action="#" method="post">
                                                       <input type="email" class="form-control" name="email" placeholder="Email" required>
                                                       <input type="password" class="form-control" name="password" placeholder="Password" required>
                                                       <input type="submit" class="form-control" name="submit" value="Submit Button">
                                                       <a href="https://www.facebook.com/templatemo">Forgot your password?</a>
                                                  </form>
                                             </div>
                                        </div>
                                   </div>

                              </div>
                         </div>
                    </div>

               </div>
          </div>
     </section>

     <!-- SCRIPTS -->

     <script src="{%static 'js/bootstrap.min.js' %}"></script>
     <script src="{%static 'js/smoothscroll.js' %}"></script>
     <script src="{%static 'js/custom.js' %}"></script>
     <script src="{%static 'js/jquery.js' %}"></script>
     <script type="text/javascript">
					var CID = "endtime";

					if(window.CID != null)
					{
						// var dTime = document.getElementById(CID).innerText;
						// var iTime = dTime*24*3600;
                        var iTime = document.getElementById(CID).innerText;
						var Account;

						RemainTime();
					}
					function RemainTime()
					{
						var iDay,iHour,iMinute,iSecond;
						var sDay="",sHour="",sMinute="",sSecond="",sTime="";
						if (iTime >= 0)
						{
							iDay = parseInt(iTime/24/3600);
							if (iDay > 0)
							{
								sDay = iDay + "天";
							}
							iHour = parseInt((iTime/3600)%24);
							if (iHour > 0){
								sHour = iHour + ":";
							}
							iMinute = parseInt((iTime/60)%60);
							if (iMinute > 0){
								sMinute = iMinute + ":";
							}
							iSecond = parseInt(iTime%60);
							if (iSecond >= 0){
								sSecond = iSecond + "";
							}
							if ((sDay=="")&&(sHour=="")){
								sTime="<span style='color:darkorange'>" + sMinute+sSecond + "</font>";
							}
							else
							{
								sTime=sDay+sHour+sMinute+sSecond;
							}
							if(iTime==0){
								clearTimeout(Account);
								  sTime="<span style='color:green'>！</span>";
                                  window.location.href='/exam/end_exam/';

							}
							else
							{
								Account = setTimeout("RemainTime()",1000);
							}
							iTime=iTime-1;
						}
						else
						{
								sTime="<span style='color:red'>考试时间到！</span>";
                                {#$.get('/exam/end_exam/')#}
						}
						document.getElementById(CID).innerHTML = sTime;
					}

     </script> <!--倒计时脚本-->

</body>
</html>